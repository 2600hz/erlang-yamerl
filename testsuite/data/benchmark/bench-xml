#!/usr/bin/env escript
%% vim:ft=erlang:

main([Input, Count_S]) ->
    Count = list_to_integer(Count_S),
    {ok, Content} = file:read_file(Input),
    T0 = erlang:now(),
    loop(Content, Count),
    T1 = erlang:now(),
    print_result(Count, T0, T1).

loop(Content, Count) when Count >= 1 ->
    xmerl_sax_parser:stream(Content, [
        {event_fun, fun(_, _, S) -> S end},
        {event_state, []}
      ]),
    loop(Content, Count - 1);
loop(_, 0) ->
    ok.

print_result(Count, T0, T1) when Count > 0 ->
    Diff = timer:now_diff(T1, T0),
    io:format("  xmerl_sax_parser: ~8.2f Âµs~n",
      [Diff / Count]);
print_result(_, _, _) ->
    io:format("No result~n", []).
